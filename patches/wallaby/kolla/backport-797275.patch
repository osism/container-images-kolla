From 2676a66163648ca76326d96b891b8ae53dac6012 Mon Sep 17 00:00:00 2001
From: Piotr Parczewski <piotr@stackhpc.com>
Date: Mon, 21 Jun 2021 12:39:28 +0200
Subject: [PATCH] Bump up cAdvisor's version

Change-Id: I987ea163e4c4e331e0e2c136b7f55890dd9d469b
---

diff --git a/docker/prometheus/prometheus-cadvisor/Dockerfile.j2 b/docker/prometheus/prometheus-cadvisor/Dockerfile.j2
index 53bd6b7..2f4e556 100644
--- a/docker/prometheus/prometheus-cadvisor/Dockerfile.j2
+++ b/docker/prometheus/prometheus-cadvisor/Dockerfile.j2
@@ -8,13 +8,17 @@
 {% import "macros.j2" as macros with context %}
 
 {% block prometheus_cadvisor_repository_version %}
-ENV prometheus_cadvisor_version=0.35.0
+ENV prometheus_cadvisor_version=0.38.7
+ENV prometheus_cadvisor_sha256sum=fdb86c256df682cfec2abd57a4405c919ed26f1e27ebfabf487f6c516bc7f6c7
 {% endblock %}
 
 {% if base_arch in ['x86_64'] %}
 
 {% block prometheus_cadvisor_install %}
-RUN curl -o /opt/cadvisor https://github.com/google/cadvisor/releases/download/v${prometheus_cadvisor_version}/cadvisor && chmod 0755 /opt/cadvisor
+RUN curl -o /tmp/cadvisor https://github.com/google/cadvisor/releases/download/v${prometheus_cadvisor_version}/cadvisor \
+    && echo "${prometheus_cadvisor_sha256sum} /tmp/cadvisor" | sha256sum -c \
+    && mv /tmp/cadvisor /opt \
+    && chmod 0755 /opt/cadvisor
 {% endblock %}
 
 {% else %}
@@ -24,7 +28,7 @@
         {% set cadvisor_packages = [
              'libjs-bootstrap',
              'libjs-jquery',
-             'https://snapshot.debian.org/archive/debian/20180503T060640Z/pool/main/c/cadvisor/cadvisor_0.27.1+dfsg2-1_arm64.deb'
+             'cadvisor'
         ] %}
 
 {{ macros.install_packages(cadvisor_packages | customizable("packages")) }}
diff --git a/releasenotes/notes/update-cadvisor-v0.38.7-a0ff88006b5ff3f7.yaml b/releasenotes/notes/update-cadvisor-v0.38.7-a0ff88006b5ff3f7.yaml
new file mode 100644
index 0000000..3ac6d17
--- /dev/null
+++ b/releasenotes/notes/update-cadvisor-v0.38.7-a0ff88006b5ff3f7.yaml
@@ -0,0 +1,4 @@
+---
+features:
+  - |
+    cAdvisor has been updated to 0.38.7 version.
