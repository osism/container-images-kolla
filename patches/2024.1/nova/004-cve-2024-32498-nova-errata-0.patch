From a254ae2ce092309db07632e673165c99efa7dc49 Mon Sep 17 00:00:00 2001
From: Dan Smith <dansmith@redhat.com>
Date: Mon, 1 Jul 2024 09:06:40 -0700
Subject: [PATCH 4/4] Fix vmdk_allowed_types checking

Related-Bug: #2059809
---
 nova/virt/libvirt/utils.py | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/nova/virt/libvirt/utils.py b/nova/virt/libvirt/utils.py
index 38ad0fd94a..902852a733 100644
--- a/nova/virt/libvirt/utils.py
+++ b/nova/virt/libvirt/utils.py
@@ -168,6 +168,8 @@ def create_image(
                     reason=_('Base image failed safety check'))
 
         base_details = images.qemu_img_info(backing_file)
+        if base_details.file_format == 'vmdk':
+            images.check_vmdk_image('base', base_details)
         if base_details.backing_file is not None:
             LOG.warning('Base image %s failed safety check', backing_file)
             raise exception.InvalidDiskInfo(
-- 
2.41.0
